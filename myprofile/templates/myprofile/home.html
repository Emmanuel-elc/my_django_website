{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile</title>
    <link rel="stylesheet" href="{% static 'myprofile/style.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav>
    <div class="container">
        <h1 class="logo">Emmanuel Muganzi</h1>
        <ul class="nav-links">
            <li><a href="{% url 'home' %}">Home</a></li>
            <li><a href="{% url 'projects' %}">Projects</a></li>
            <li><a href="{% url 'contact' %}">Contact</a></li>
        </ul>
    </div>
</nav>


    <!-- Hero Section -->
    <section class="hero">
        <div class="container hero-content">
            <h2>Welcome to My Profile</h2>
            <p>Hello! I am Emmanuel Muganzi, a passionate developer and technology enthusiast. Explore my work and feel free to contact me!</p>
            <a href="#contact" class="btn">Get in Touch</a>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="section">
        <div class="container">
            <h2>About Me</h2>
            <p>I love building web applications, learning new technologies, and sharing knowledge. I am always looking for exciting opportunities to grow and contribute.</p>
        </div>
    </section>

    <!-- Projects Section -->
    <section id="projects" class="section">
        <div class="container">
            <h2>Projects</h2>
            <div class="projects-grid">
                <div class="project-card">
                    <h3>Project 1: Secure Voting System</h3>
                    <p>Developed a web-based voting platform using Node.js and Express. Features include voter login, admin dashboard for poll creation, real-time results with charts, and poll expiration.</p>
                </div>
                <div class="project-card">
                    <h3>Project 2: E-Commerce Website</h3>
                    <p>Created a fully functional e-commerce website using Django and React, with user authentication, product listings, shopping cart, and payment integration via Stripe.</p>
                </div>
                <div class="project-card">
                    <h3>Project 3: Student Magazine</h3>
                    <p>Designed a student magazine showcasing creative writing, motivational quotes, poems, Bible verses, leadership pieces, and humor. Promotes creativity and inspiration within the school.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
<section id="contact" class="section contact-section">
    <div class="container">
        <h2>Contact Me</h2>
        <p>You can reach me through the following:</p>
                <div class="contact-links">
                        <a href="#" id="open-contact-modal">Email</a>
                        <a href="tel:+256700000000" target="_blank">Phone</a>
                        <a href="https://www.linkedin.com/in/emmanuel-muganzi" target="_blank">LinkedIn</a>
                        <a href="https://github.com/Emmanuel-elc" target="_blank">GitHub</a>
                </div>
        </div>
</section>

<!-- Contact Modal -->
<div id="contact-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#fff; padding:2rem; border-radius:8px; max-width:400px; margin:auto; position:relative;">
        <button id="close-contact-modal" style="position:absolute; top:8px; right:8px; background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
        <h3>Contact Me</h3>
        <form id="contact-modal-form">
            <label>Name:<br><input type="text" name="name" required></label><br><br>
            <label>Email:<br><input type="email" name="email" required></label><br><br>
            <label>Message:<br><textarea name="message" rows="4" required></textarea></label><br><br>
            <button type="submit">Send</button>
            <div id="contact-modal-status" style="margin-top:1em;"></div>
        </form>
    </div>
</div>
    </div>
</section>

<!-- Hidden CSRF form so Django sets the csrftoken cookie on page load (helps AJAX) -->
<form id="csrf-form" method="post" style="display:none;">{% csrf_token %}</form>


    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Emmanuel Muganzi. All rights reserved.</p>
    </footer>
    <script>
    // Helper to get CSRF token from cookies
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    document.addEventListener('DOMContentLoaded', function () {
        // Modal logic
        const modal = document.getElementById('contact-modal');
        const openBtn = document.getElementById('open-contact-modal');
        const closeBtn = document.getElementById('close-contact-modal');
        const form = document.getElementById('contact-modal-form');
        const statusDiv = document.getElementById('contact-modal-status');

        openBtn.addEventListener('click', function(e) {
            e.preventDefault();
            modal.style.display = 'flex';
            statusDiv.textContent = '';
        });
        closeBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });
        modal.addEventListener('click', function(e) {
            if (e.target === modal) modal.style.display = 'none';
        });

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            statusDiv.textContent = 'Sending...';
            const formData = new FormData(form);
            const payload = new URLSearchParams();
            for (const [key, value] of formData.entries()) {
                payload.append(key, value);
            }
            payload.append('subject', 'Contact from website');
            const csrftoken = getCookie('csrftoken');
            fetch('/contact/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrftoken || '',
                },
                body: payload.toString(),
            }).then(resp => resp.json())
              .then(data => {
                  if (data && data.success) {
                      statusDiv.textContent = 'Message sent â€” thank you!';
                      form.reset();
                  } else {
                      statusDiv.textContent = 'Could not send message via server.';
                  }
              }).catch(err => {
                  console.error(err);
                  statusDiv.textContent = 'Network error.';
              });
        });
    });
    </script>
</body>
</html>
